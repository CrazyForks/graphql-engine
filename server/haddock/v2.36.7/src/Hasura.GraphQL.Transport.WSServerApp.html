<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.GraphQL.Transport.WSServerApp</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerApp"><span class="hs-identifier">createWSServerApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html#stopWSServerApp"><span class="hs-identifier">stopWSServerApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerEnv"><span class="hs-identifier">createWSServerEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-d63f7c0774c9603306fb6be4536181f7e6facdd649f3f450b4e7dfd3d91cda94/share/doc/html/src/Control.Concurrent.Async.Lifted.Safe.html"><span class="hs-identifier">Control.Concurrent.Async.Lifted.Safe</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/Control.Exception.Lifted.html"><span class="hs-identifier">Control.Exception.Lifted</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MC</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Encoding.html"><span class="hs-identifier">Data.Aeson.Encoding</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.html#pack"><span class="hs-identifier">pack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.App.State.html"><span class="hs-identifier">Hasura.App.State</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.DataConnector.Agent.Client.html"><span class="hs-identifier">Hasura.Backends.DataConnector.Agent.Client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.DataConnector.Agent.Client.html#AgentLicenseKey"><span class="hs-identifier">AgentLicenseKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.CredentialCache.html"><span class="hs-identifier">Hasura.CredentialCache</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.html"><span class="hs-identifier">Hasura.GraphQL.Execute</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Logging.html"><span class="hs-identifier">Hasura.GraphQL.Logging</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier">MonadExecuteQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.HTTP.Protocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQExecError"><span class="hs-identifier">encodeGQExecError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.Instances.html"><span class="hs-identifier">Hasura.GraphQL.Transport.Instances</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Protocol</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Server</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html"><span class="hs-identifier">Hasura.GraphQL.Transport.WebSocket.Types</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.4.5/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.QueryTags.html"><span class="hs-identifier">Hasura.QueryTags</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.AppStateRef.html"><span class="hs-identifier">Hasura.Server.AppStateRef</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier">UserAuthentication</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#WSConnectionInitTimeout"><span class="hs-identifier">WSConnectionInitTimeout</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Limits.html"><span class="hs-identifier">Hasura.Server.Limits</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Metrics.html"><span class="hs-identifier">Hasura.Server.Metrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Metrics.html#ServerMetrics"><span class="hs-identifier">ServerMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Prometheus.html"><span class="hs-identifier">Hasura.Server.Prometheus</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Server.Prometheus.html#PrometheusMetrics"><span class="hs-identifier">PrometheusMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Hasura.Server.Prometheus.html#decWebsocketConnections"><span class="hs-identifier">decWebsocketConnections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Hasura.Server.Prometheus.html#incWebsocketConnections"><span class="hs-identifier">incWebsocketConnections</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier">MonadGetPolicies</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Services.Network.html"><span class="hs-identifier">Hasura.Services.Network</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Tracing.html"><span class="hs-identifier">Hasura.Tracing</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tracing</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/websockets-0.12.7.3-ace9e650e85dd6f2f2179ec47bba2f5dfacb8e002a1c77fe7c2fbe7ac37aed32/share/doc/html/src/Network.WebSockets.html"><span class="hs-identifier">Network.WebSockets</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-06012a11b777bc09e40aa53fadcaf2cf3ff24b6963c248e1bf14879de98aff1f/share/doc/html/src/System.Metrics.Gauge.html"><span class="hs-identifier">System.Metrics.Gauge</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EKG.Gauge</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span id="local-6989586621688064085"><span id="local-6989586621688064104"><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerApp"><span class="hs-identifier hs-type">createWSServerApp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- only due to https://gitlab.haskell.org/ghc/ghc/-/issues/15681</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/monad-control-1.0.3.1-db4229aec3d9c1011503cf06798714c732b74d731fab23998dd34d578ed6d457/share/doc/html/src/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MC.MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/constraints-0.13.4-50ce339e2ef398cdf6965bdd48656adf620ab887368a22e14fa1c6033bdc6766/share/doc/html/src/Data.Constraint.Forall.html#Forall"><span class="hs-identifier hs-type">LA.Forall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-async-0.10.2.3-d63f7c0774c9603306fb6be4536181f7e6facdd649f3f450b4e7dfd3d91cda94/share/doc/html/src/Control.Concurrent.Async.Lifted.Safe.html#Pure"><span class="hs-identifier hs-type">LA.Pure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Hasura.Server.Auth.html#UserAuthentication"><span class="hs-identifier hs-type">UserAuthentication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Execute.Common.html#MonadGQLExecutionCheck"><span class="hs-identifier hs-type">E.MonadGQLExecutionCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#MonadWSLog"><span class="hs-identifier hs-type">WS.MonadWSLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.QueryLog.html#MonadQueryLog"><span class="hs-identifier hs-type">MonadQueryLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Logging.ExecutionLog.html#MonadExecutionLog"><span class="hs-identifier hs-type">MonadExecutionLog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="Hasura.GraphQL.Transport.HTTP.html#MonadExecuteQuery"><span class="hs-identifier hs-type">MonadExecuteQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Hasura.QueryTags.html#MonadQueryTags"><span class="hs-identifier hs-type">MonadQueryTags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="Hasura.Server.Limits.html#HasResourceLimits"><span class="hs-identifier hs-type">HasResourceLimits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="Hasura.Services.Network.html#ProvidesNetwork"><span class="hs-identifier hs-type">ProvidesNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="Hasura.Tracing.Class.html#MonadTrace"><span class="hs-identifier hs-type">Tracing.MonadTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/unordered-containers-0.2.19.1-fc2e0f1d37ef28cdf90ef4bc038ad0de1aaee4c64eb6ed4574eefbec08a983d1/share/doc/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#EngineLogType"><span class="hs-identifier hs-type">L.EngineLogType</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#WSServerEnv"><span class="hs-identifier hs-type">WSServerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064104"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#WSConnectionInitTimeout"><span class="hs-identifier hs-type">WSConnectionInitTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.CredentialCache.html#CredentialCache"><span class="hs-identifier hs-type">CredentialCache</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.DataConnector.Agent.Client.html#AgentLicenseKey"><span class="hs-identifier hs-type">AgentLicenseKey</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="hs-comment">-- | aka generalized 'WS.ServerApp'</span></span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#HasuraServerApp"><span class="hs-identifier hs-type">WS.HasuraServerApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064085"><span class="hs-identifier hs-type">m</span></a></span></span></span><span>
</span><span id="line-75"></span><span id="createWSServerApp"><span class="annot"><span class="annottext">createWSServerApp :: forall (m :: * -&gt; *) impl.
(MonadIO m, MonadFail m, MonadBaseControl IO m, Forall (Pure m),
 UserAuthentication m, MonadGQLExecutionCheck m, MonadWSLog m,
 MonadQueryLog m, MonadExecutionLog m, MonadExecuteQuery m,
 MonadMetadataStorage m, MonadQueryTags m, HasResourceLimits m,
 ProvidesNetwork m, MonadTrace m, MonadGetPolicies m) =&gt;
HashSet (EngineLogType Hasura)
-&gt; WSServerEnv impl
-&gt; WSConnectionInitTimeout
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; HasuraServerApp m
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerApp"><span class="hs-identifier hs-var hs-var">createWSServerApp</span></a></span></span><span> </span><span id="local-6989586621688064364"><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621688064364"><span class="hs-identifier hs-var">enabledLogTypes</span></a></span></span><span> </span><span id="local-6989586621688064365"><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span></span><span> </span><span id="local-6989586621688064366"><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621688064366"><span class="hs-identifier hs-var">connInitTimeout</span></a></span></span><span> </span><span id="local-6989586621688064367"><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621688064367"><span class="hs-identifier hs-var">licenseKeyCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621688064368"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621688064368"><span class="hs-identifier hs-var">ipAddress</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621688064369"><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621688064369"><span class="hs-identifier hs-var">pendingConn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688064370"><span class="annot"><span class="annottext">getMetricsConfig :: IO MetricsConfig
</span><a href="#local-6989586621688064370"><span class="hs-identifier hs-var hs-var">getMetricsConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; MetricsConfig
</span><a href="Hasura.RQL.Types.SchemaCache.html#scMetricsConfig"><span class="hs-identifier hs-var">scMetricsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; MetricsConfig)
-&gt; IO SchemaCache -&gt; IO MetricsConfig
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO SchemaCache
forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; AppStateRef impl
forall impl. WSServerEnv impl -&gt; AppStateRef impl
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseAppStateRef"><span class="hs-identifier hs-var">_wseAppStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="annottext">IO MetricsConfig
-&gt; WSConnectionInitTimeout
-&gt; WSServer WSConnData
-&gt; PrometheusMetrics
-&gt; WSHandlers m WSConnData
-&gt; IpAddress
-&gt; PendingConnection
-&gt; m ()
forall (m :: * -&gt; *) a.
(MonadIO m, MonadBaseControl IO m, Forall (Pure m), MonadWSLog m,
 MonadGetPolicies m) =&gt;
IO MetricsConfig
-&gt; WSConnectionInitTimeout
-&gt; WSServer a
-&gt; PrometheusMetrics
-&gt; WSHandlers m a
-&gt; HasuraServerApp m
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#createServerApp"><span class="hs-identifier hs-var">WS.createServerApp</span></a></span><span> </span><span class="annot"><span class="annottext">IO MetricsConfig
</span><a href="#local-6989586621688064370"><span class="hs-identifier hs-var">getMetricsConfig</span></a></span><span> </span><span class="annot"><span class="annottext">WSConnectionInitTimeout
</span><a href="#local-6989586621688064366"><span class="hs-identifier hs-var">connInitTimeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; WSServer WSConnData
forall impl. WSServerEnv impl -&gt; WSServer WSConnData
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseServer"><span class="hs-identifier hs-var">_wseServer</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621688064377"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">WSHandlers m WSConnData
</span><a href="#local-6989586621688064378"><span class="hs-identifier hs-var">handlers</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621688064368"><span class="hs-identifier hs-var">ipAddress</span></a></span><span> </span><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621688064369"><span class="hs-identifier hs-var">pendingConn</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621688064378"><span class="annot"><span class="annottext">handlers :: WSHandlers m WSConnData
</span><a href="#local-6989586621688064378"><span class="hs-identifier hs-var hs-var">handlers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">(WSId
 -&gt; RequestHead
 -&gt; IpAddress
 -&gt; WSSubProtocol
 -&gt; m (Either RejectRequest (AcceptWith WSConnData)))
-&gt; (WSConn WSConnData -&gt; ByteString -&gt; WSSubProtocol -&gt; m ())
-&gt; OnCloseH m WSConnData
-&gt; WSHandlers m WSConnData
forall (m :: * -&gt; *) a.
(WSId
 -&gt; RequestHead
 -&gt; IpAddress
 -&gt; WSSubProtocol
 -&gt; m (Either RejectRequest (AcceptWith a)))
-&gt; (WSConn a -&gt; ByteString -&gt; WSSubProtocol -&gt; m ())
-&gt; OnCloseH m a
-&gt; WSHandlers m a
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#WSHandlers"><span class="hs-identifier hs-var">WS.WSHandlers</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">WSId
-&gt; RequestHead
-&gt; IpAddress
-&gt; WSSubProtocol
-&gt; m (Either RejectRequest (AcceptWith WSConnData))
</span><a href="#local-6989586621688064380"><span class="hs-identifier hs-var">onConnHandler</span></a></span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><span class="annottext">WSConn WSConnData -&gt; ByteString -&gt; WSSubProtocol -&gt; m ()
</span><a href="#local-6989586621688064381"><span class="hs-identifier hs-var">onMessageHandler</span></a></span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><span class="annottext">OnCloseH m WSConnData
</span><a href="#local-6989586621688064382"><span class="hs-identifier hs-var">onCloseHandler</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621688064383"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621688064383"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; Logger Hasura
forall impl. WSServerEnv impl -&gt; Logger Hasura
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseLogger"><span class="hs-identifier hs-var">_wseLogger</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621688064385"><span class="annot"><span class="annottext">serverMetrics :: ServerMetrics
</span><a href="#local-6989586621688064385"><span class="hs-identifier hs-var hs-var">serverMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; ServerMetrics
forall impl. WSServerEnv impl -&gt; ServerMetrics
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseServerMetrics"><span class="hs-identifier hs-var">_wseServerMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621688064377"><span class="annot"><span class="annottext">prometheusMetrics :: PrometheusMetrics
</span><a href="#local-6989586621688064377"><span class="hs-identifier hs-var hs-var">prometheusMetrics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; PrometheusMetrics
forall impl. WSServerEnv impl -&gt; PrometheusMetrics
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wsePrometheusMetrics"><span class="hs-identifier hs-var">_wsePrometheusMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621688064388"><span class="annot"><span class="annottext">getAuthMode :: IO AuthMode
</span><a href="#local-6989586621688064388"><span class="hs-identifier hs-var hs-var">getAuthMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; AuthMode
</span><a href="Hasura.App.State.html#acAuthMode"><span class="hs-identifier hs-var">acAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">(AppContext -&gt; AuthMode) -&gt; IO AppContext -&gt; IO AuthMode
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; AppStateRef impl
forall impl. WSServerEnv impl -&gt; AppStateRef impl
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseAppStateRef"><span class="hs-identifier hs-var">_wseAppStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621688064391"><span class="annot"><span class="annottext">wsActions :: WSSubProtocol -&gt; WSActions WSConnData
</span><a href="#local-6989586621688064391"><span class="hs-identifier hs-var hs-var">wsActions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger Hasura -&gt; WSSubProtocol -&gt; WSActions WSConnData
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#mkWSActions"><span class="hs-identifier hs-var">mkWSActions</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688064383"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-comment">-- Mask async exceptions during event processing to help maintain integrity of mutable vars:</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-comment">-- here `sp` stands for sub-protocol</span><span>
</span><span id="line-94"></span><span>    </span><span id="local-6989586621688064380"><span class="annot"><span class="annottext">onConnHandler :: WSId
-&gt; RequestHead
-&gt; IpAddress
-&gt; WSSubProtocol
-&gt; m (Either RejectRequest (AcceptWith WSConnData))
</span><a href="#local-6989586621688064380"><span class="hs-identifier hs-var hs-var">onConnHandler</span></a></span></span><span> </span><span id="local-6989586621688064393"><span class="annot"><span class="annottext">WSId
</span><a href="#local-6989586621688064393"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span id="local-6989586621688064394"><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621688064394"><span class="hs-identifier hs-var">rh</span></a></span></span><span> </span><span id="local-6989586621688064395"><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621688064395"><span class="hs-identifier hs-var">ip</span></a></span></span><span> </span><span id="local-6989586621688064396"><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064396"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either RejectRequest (AcceptWith WSConnData))
-&gt; m (Either RejectRequest (AcceptWith WSConnData))
forall (m :: * -&gt; *) a. MonadBaseControl IO m =&gt; m a -&gt; m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/Control.Exception.Lifted.html#mask_"><span class="hs-identifier hs-var">mask_</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Gauge -&gt; IO ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-06012a11b777bc09e40aa53fadcaf2cf3ff24b6963c248e1bf14879de98aff1f/share/doc/html/src/System.Metrics.Gauge.html#inc"><span class="hs-identifier hs-var">EKG.Gauge.inc</span></a></span><span> </span><span class="annot"><span class="annottext">(Gauge -&gt; IO ()) -&gt; Gauge -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerMetrics -&gt; Gauge
</span><a href="Hasura.Server.Metrics.html#smWebsocketConnections"><span class="hs-identifier hs-var">smWebsocketConnections</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621688064385"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnectionsGauge -&gt; IO ()
</span><a href="Hasura.Server.Prometheus.html#incWebsocketConnections"><span class="hs-identifier hs-var">incWebsocketConnections</span></a></span><span> </span><span class="annot"><span class="annottext">(ConnectionsGauge -&gt; IO ()) -&gt; ConnectionsGauge -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; ConnectionsGauge
</span><a href="Hasura.Server.Prometheus.html#pmConnections"><span class="hs-identifier hs-var">pmConnections</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621688064377"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">(ReaderT
   (WSServerEnv impl) m (Either RejectRequest (AcceptWith WSConnData))
 -&gt; WSServerEnv impl
 -&gt; m (Either RejectRequest (AcceptWith WSConnData)))
-&gt; WSServerEnv impl
-&gt; ReaderT
     (WSServerEnv impl) m (Either RejectRequest (AcceptWith WSConnData))
-&gt; m (Either RejectRequest (AcceptWith WSConnData))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (WSServerEnv impl) m (Either RejectRequest (AcceptWith WSConnData))
-&gt; WSServerEnv impl
-&gt; m (Either RejectRequest (AcceptWith WSConnData))
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (WSServerEnv impl) m (Either RejectRequest (AcceptWith WSConnData))
 -&gt; m (Either RejectRequest (AcceptWith WSConnData)))
-&gt; ReaderT
     (WSServerEnv impl) m (Either RejectRequest (AcceptWith WSConnData))
-&gt; m (Either RejectRequest (AcceptWith WSConnData))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OnConnH (ReaderT (WSServerEnv impl) m) WSConnData
forall (m :: * -&gt; *) impl.
(MonadFail m, MonadIO m, MonadReader (WSServerEnv impl) m) =&gt;
OnConnH m WSConnData
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#onConn"><span class="hs-identifier hs-var">onConn</span></a></span><span> </span><span class="annot"><span class="annottext">WSId
</span><a href="#local-6989586621688064393"><span class="hs-identifier hs-var">rid</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHead
</span><a href="#local-6989586621688064394"><span class="hs-identifier hs-var">rh</span></a></span><span> </span><span class="annot"><span class="annottext">IpAddress
</span><a href="#local-6989586621688064395"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSSubProtocol -&gt; WSActions WSConnData
</span><a href="#local-6989586621688064391"><span class="hs-identifier hs-var">wsActions</span></a></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064396"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621688064381"><span class="annot"><span class="annottext">onMessageHandler :: WSConn WSConnData -&gt; ByteString -&gt; WSSubProtocol -&gt; m ()
</span><a href="#local-6989586621688064381"><span class="hs-identifier hs-var hs-var">onMessageHandler</span></a></span></span><span> </span><span id="local-6989586621688064405"><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064405"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621688064406"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688064406"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621688064407"><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064407"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>      </span><span id="local-6989586621688064408"><span class="annot"><span class="annottext">TraceQueryStatus
</span><a href="#local-6989586621688064408"><span class="hs-identifier hs-var">traceQueryStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO TraceQueryStatus -&gt; m TraceQueryStatus
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO TraceQueryStatus -&gt; m TraceQueryStatus)
-&gt; IO TraceQueryStatus -&gt; m TraceQueryStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; TraceQueryStatus
</span><a href="Hasura.App.State.html#acTraceQueryStatus"><span class="hs-identifier hs-var">acTraceQueryStatus</span></a></span><span> </span><span class="annot"><span class="annottext">(AppContext -&gt; TraceQueryStatus)
-&gt; IO AppContext -&gt; IO TraceQueryStatus
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; AppStateRef impl
forall impl. WSServerEnv impl -&gt; AppStateRef impl
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseAppStateRef"><span class="hs-identifier hs-var">_wseAppStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (m :: * -&gt; *) a. MonadBaseControl IO m =&gt; m a -&gt; m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/Control.Exception.Lifted.html#mask_"><span class="hs-identifier hs-var">mask_</span></a></span><span>
</span><span id="line-102"></span><span>        </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
-&gt; IO AuthMode
-&gt; WSServerEnv impl
-&gt; WSConn WSConnData
-&gt; ByteString
-&gt; WSActions WSConnData
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; TraceQueryStatus
-&gt; m ()
forall (m :: * -&gt; *) impl.
(MonadIO m, UserAuthentication m, MonadGQLExecutionCheck m,
 MonadQueryLog m, MonadExecutionLog m, MonadExecuteQuery m,
 MonadBaseControl IO m, MonadMetadataStorage m, MonadQueryTags m,
 HasResourceLimits m, ProvidesNetwork m, MonadTrace m,
 MonadGetPolicies m) =&gt;
HashSet (EngineLogType Hasura)
-&gt; IO AuthMode
-&gt; WSServerEnv impl
-&gt; WSConn WSConnData
-&gt; ByteString
-&gt; WSActions WSConnData
-&gt; Maybe (CredentialCache AgentLicenseKey)
-&gt; TraceQueryStatus
-&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#onMessage"><span class="hs-identifier hs-var">onMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (EngineLogType Hasura)
</span><a href="#local-6989586621688064364"><span class="hs-identifier hs-var">enabledLogTypes</span></a></span><span> </span><span class="annot"><span class="annottext">IO AuthMode
</span><a href="#local-6989586621688064388"><span class="hs-identifier hs-var">getAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064405"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688064406"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSSubProtocol -&gt; WSActions WSConnData
</span><a href="#local-6989586621688064391"><span class="hs-identifier hs-var">wsActions</span></a></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064407"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (CredentialCache AgentLicenseKey)
</span><a href="#local-6989586621688064367"><span class="hs-identifier hs-var">licenseKeyCache</span></a></span><span> </span><span class="annot"><span class="annottext">TraceQueryStatus
</span><a href="#local-6989586621688064408"><span class="hs-identifier hs-var">traceQueryStatus</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621688064382"><span class="annot"><span class="annottext">onCloseHandler :: OnCloseH m WSConnData
</span><a href="#local-6989586621688064382"><span class="hs-identifier hs-var hs-var">onCloseHandler</span></a></span></span><span> </span><span id="local-6989586621688064411"><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064411"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (m :: * -&gt; *) a. MonadBaseControl IO m =&gt; m a -&gt; m a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/lifted-base-0.2.3.12-dda1adedff1e58883d645c3d159e5d196513de2aea81f9a332fe2d42327ade1a/share/doc/html/src/Control.Exception.Lifted.html#mask_"><span class="hs-identifier hs-var">mask_</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>      </span><span id="local-6989586621688064412"><span class="annot"><span class="annottext">IO GranularPrometheusMetricsState
</span><a href="#local-6989586621688064412"><span class="hs-identifier hs-var">granularPrometheusMetricsState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (IO GranularPrometheusMetricsState)
forall (m :: * -&gt; *).
MonadGetPolicies m =&gt;
m (IO GranularPrometheusMetricsState)
</span><a href="Hasura.Server.Types.html#runGetPrometheusMetricsGranularity"><span class="hs-identifier hs-var">runGetPrometheusMetricsGranularity</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Gauge -&gt; IO ()
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/ekg-core-0.1.1.7-06012a11b777bc09e40aa53fadcaf2cf3ff24b6963c248e1bf14879de98aff1f/share/doc/html/src/System.Metrics.Gauge.html#dec"><span class="hs-identifier hs-var">EKG.Gauge.dec</span></a></span><span> </span><span class="annot"><span class="annottext">(Gauge -&gt; IO ()) -&gt; Gauge -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerMetrics -&gt; Gauge
</span><a href="Hasura.Server.Metrics.html#smWebsocketConnections"><span class="hs-identifier hs-var">smWebsocketConnections</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621688064385"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnectionsGauge -&gt; IO ()
</span><a href="Hasura.Server.Prometheus.html#decWebsocketConnections"><span class="hs-identifier hs-var">decWebsocketConnections</span></a></span><span> </span><span class="annot"><span class="annottext">(ConnectionsGauge -&gt; IO ()) -&gt; ConnectionsGauge -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics -&gt; ConnectionsGauge
</span><a href="Hasura.Server.Prometheus.html#pmConnections"><span class="hs-identifier hs-var">pmConnections</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621688064377"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; ServerMetrics
-&gt; PrometheusMetrics
-&gt; SubscriptionsState
-&gt; WSConn WSConnData
-&gt; IO GranularPrometheusMetricsState
-&gt; m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura
-&gt; ServerMetrics
-&gt; PrometheusMetrics
-&gt; SubscriptionsState
-&gt; WSConn WSConnData
-&gt; IO GranularPrometheusMetricsState
-&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#onClose"><span class="hs-identifier hs-var">onClose</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688064383"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621688064385"><span class="hs-identifier hs-var">serverMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621688064377"><span class="hs-identifier hs-var">prometheusMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; SubscriptionsState
forall impl. WSServerEnv impl -&gt; SubscriptionsState
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseSubscriptionState"><span class="hs-identifier hs-var">_wseSubscriptionState</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064365"><span class="hs-identifier hs-var">serverEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064411"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">IO GranularPrometheusMetricsState
</span><a href="#local-6989586621688064412"><span class="hs-identifier hs-var">granularPrometheusMetricsState</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span id="local-6989586621688064188"><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html#stopWSServerApp"><span class="hs-identifier hs-type">stopWSServerApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#WSServerEnv"><span class="hs-identifier hs-type">WSServerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064188"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-111"></span><span id="stopWSServerApp"><span class="annot"><span class="annottext">stopWSServerApp :: forall impl. WSServerEnv impl -&gt; IO ()
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#stopWSServerApp"><span class="hs-identifier hs-var hs-var">stopWSServerApp</span></a></span></span><span> </span><span id="local-6989586621688064417"><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064417"><span class="hs-identifier hs-var">wsEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSServer WSConnData -&gt; IO ()
forall a. WSServer a -&gt; IO ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#shutdown"><span class="hs-identifier hs-var">WS.shutdown</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; WSServer WSConnData
forall impl. WSServerEnv impl -&gt; WSServer WSConnData
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#_wseServer"><span class="hs-identifier hs-var">_wseServer</span></a></span><span> </span><span class="annot"><span class="annottext">WSServerEnv impl
</span><a href="#local-6989586621688064417"><span class="hs-identifier hs-var">wsEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span id="local-6989586621688064191"><span id="local-6989586621688064193"><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerEnv"><span class="hs-identifier hs-type">createWSServerEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.App.State.html#HasAppEnv"><span class="hs-identifier hs-type">HasAppEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064191"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688064191"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Hasura.Server.AppStateRef.html#AppStateRef"><span class="hs-identifier hs-type">AppStateRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064193"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="#local-6989586621688064191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#WSServerEnv"><span class="hs-identifier hs-type">WSServerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688064193"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-119"></span><span id="createWSServerEnv"><span class="annot"><span class="annottext">createWSServerEnv :: forall (m :: * -&gt; *) impl.
(HasAppEnv m, MonadIO m) =&gt;
AppStateRef impl -&gt; m (WSServerEnv impl)
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#createWSServerEnv"><span class="hs-identifier hs-var hs-var">createWSServerEnv</span></a></span></span><span> </span><span id="local-6989586621688064439"><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621688064439"><span class="hs-identifier hs-var">appStateRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppEnv"><span class="hs-identifier hs-type">AppEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688064441"><span id="local-6989586621688064442"><span id="local-6989586621688064443"><span id="local-6989586621688064444"><span id="local-6989586621688064445"><span id="local-6989586621688064446"><span id="local-6989586621688064447"><span id="local-6989586621688064448"><span id="local-6989586621688064449"><span id="local-6989586621688064450"><span id="local-6989586621688064451"><span id="local-6989586621688064452"><span id="local-6989586621688064453"><span id="local-6989586621688064454"><span id="local-6989586621688064455"><span id="local-6989586621688064456"><span id="local-6989586621688064457"><span id="local-6989586621688064458"><span id="local-6989586621688064459"><span id="local-6989586621688064460"><span id="local-6989586621688064461"><span id="local-6989586621688064462"><span id="local-6989586621688064463"><span id="local-6989586621688064464"><span id="local-6989586621688064465"><span id="local-6989586621688064466"><span id="local-6989586621688064467"><span id="local-6989586621688064468"><span id="local-6989586621688064469"><span id="local-6989586621688064470"><span id="local-6989586621688064471"><span id="local-6989586621688064472"><span id="local-6989586621688064473"><span id="local-6989586621688064474"><span id="local-6989586621688064475"><span class="annot"><span class="annottext">Int
Maybe Text
Maybe PGPool
Maybe (CredentialCache AgentLicenseKey)
SamplingPolicy
HostPreference
Manager
TxIsolation
ConnParams
PGPool
Refined NonNegative Seconds
TMVar MetadataResourceVersion
ConnectionOptions
CheckFeatureFlag
ServerMetrics
PersistedQueriesState
TriggersErrorLogLevelStatus
EventingMode
ReadOnlyMode
MaintenanceMode ()
InstanceId
PrometheusMetrics
ShutdownLatch
LoggingSettings
LockedEventsCtx
WSConnectionInitTimeout
KeepAliveDelay
OptionalInterval
Port
SubscriptionsState
Loggers
appEnvPort :: Port
appEnvHost :: HostPreference
appEnvMetadataDbPool :: PGPool
appEnvIntrospectionDbPool :: Maybe PGPool
appEnvManager :: Manager
appEnvLoggers :: Loggers
appEnvMetadataVersionRef :: TMVar MetadataResourceVersion
appEnvInstanceId :: InstanceId
appEnvEnableMaintenanceMode :: MaintenanceMode ()
appEnvLoggingSettings :: LoggingSettings
appEnvEventingMode :: EventingMode
appEnvEnableReadOnlyMode :: ReadOnlyMode
appEnvServerMetrics :: ServerMetrics
appEnvShutdownLatch :: ShutdownLatch
appEnvMetaVersionRef :: TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: PrometheusMetrics
appEnvTraceSamplingPolicy :: SamplingPolicy
appEnvSubscriptionState :: SubscriptionsState
appEnvLockedEventsCtx :: LockedEventsCtx
appEnvConnParams :: ConnParams
appEnvTxIso :: TxIsolation
appEnvConsoleAssetsDir :: Maybe Text
appEnvConsoleSentryDsn :: Maybe Text
appEnvConnectionOptions :: ConnectionOptions
appEnvWebSocketKeepAlive :: KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: Refined NonNegative Seconds
appEnvSchemaPollInterval :: OptionalInterval
appEnvCheckFeatureFlag :: CheckFeatureFlag
appEnvLicenseKeyCache :: Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: Int
appEnvTriggersErrorLogLevelStatus :: TriggersErrorLogLevelStatus
appEnvAsyncActionsFetchBatchSize :: Int
appEnvPersistedQueries :: PersistedQueriesState
appEnvPersistedQueriesTtl :: Int
appEnvPort :: AppEnv -&gt; Port
appEnvHost :: AppEnv -&gt; HostPreference
appEnvMetadataDbPool :: AppEnv -&gt; PGPool
appEnvIntrospectionDbPool :: AppEnv -&gt; Maybe PGPool
appEnvManager :: AppEnv -&gt; Manager
appEnvLoggers :: AppEnv -&gt; Loggers
appEnvMetadataVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvInstanceId :: AppEnv -&gt; InstanceId
appEnvEnableMaintenanceMode :: AppEnv -&gt; MaintenanceMode ()
appEnvLoggingSettings :: AppEnv -&gt; LoggingSettings
appEnvEventingMode :: AppEnv -&gt; EventingMode
appEnvEnableReadOnlyMode :: AppEnv -&gt; ReadOnlyMode
appEnvServerMetrics :: AppEnv -&gt; ServerMetrics
appEnvShutdownLatch :: AppEnv -&gt; ShutdownLatch
appEnvMetaVersionRef :: AppEnv -&gt; TMVar MetadataResourceVersion
appEnvPrometheusMetrics :: AppEnv -&gt; PrometheusMetrics
appEnvTraceSamplingPolicy :: AppEnv -&gt; SamplingPolicy
appEnvSubscriptionState :: AppEnv -&gt; SubscriptionsState
appEnvLockedEventsCtx :: AppEnv -&gt; LockedEventsCtx
appEnvConnParams :: AppEnv -&gt; ConnParams
appEnvTxIso :: AppEnv -&gt; TxIsolation
appEnvConsoleAssetsDir :: AppEnv -&gt; Maybe Text
appEnvConsoleSentryDsn :: AppEnv -&gt; Maybe Text
appEnvConnectionOptions :: AppEnv -&gt; ConnectionOptions
appEnvWebSocketKeepAlive :: AppEnv -&gt; KeepAliveDelay
appEnvWebSocketConnectionInitTimeout :: AppEnv -&gt; WSConnectionInitTimeout
appEnvGracefulShutdownTimeout :: AppEnv -&gt; Refined NonNegative Seconds
appEnvSchemaPollInterval :: AppEnv -&gt; OptionalInterval
appEnvCheckFeatureFlag :: AppEnv -&gt; CheckFeatureFlag
appEnvLicenseKeyCache :: AppEnv -&gt; Maybe (CredentialCache AgentLicenseKey)
appEnvMaxTotalHeaderLength :: AppEnv -&gt; Int
appEnvTriggersErrorLogLevelStatus :: AppEnv -&gt; TriggersErrorLogLevelStatus
appEnvAsyncActionsFetchBatchSize :: AppEnv -&gt; Int
appEnvPersistedQueries :: AppEnv -&gt; PersistedQueriesState
appEnvPersistedQueriesTtl :: AppEnv -&gt; Int
</span><a href="#local-6989586621688064441"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m AppEnv
forall (m :: * -&gt; *). HasAppEnv m =&gt; m AppEnv
</span><a href="Hasura.App.State.html#askAppEnv"><span class="hs-identifier hs-var">askAppEnv</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688064512"><span class="annot"><span class="annottext">getCorsPolicy :: IO CorsPolicy
</span><a href="#local-6989586621688064512"><span class="hs-identifier hs-var hs-var">getCorsPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppContext -&gt; CorsPolicy
</span><a href="Hasura.App.State.html#acCorsPolicy"><span class="hs-identifier hs-var">acCorsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">(AppContext -&gt; CorsPolicy) -&gt; IO AppContext -&gt; IO CorsPolicy
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621688064439"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span id="local-6989586621688064514"><span class="annot"><span class="annottext">logger :: Logger Hasura
</span><a href="#local-6989586621688064514"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621688064446"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Hasura.App.State.html#AppContext"><span class="hs-identifier hs-type">AppContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688064517"><span class="annot"><span class="annottext">AllowListStatus
acEnableAllowlist :: AllowListStatus
acEnableAllowlist :: AppContext -&gt; AllowListStatus
</span><a href="#local-6989586621688064517"><span class="hs-identifier hs-var hs-var">acEnableAllowlist</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688064519"><span class="annot"><span class="annottext">AuthMode
acAuthMode :: AppContext -&gt; AuthMode
acAuthMode :: AuthMode
</span><a href="Hasura.App.State.html#acAuthMode"><span class="hs-identifier hs-var hs-var">acAuthMode</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688064520"><span class="annot"><span class="annottext">SQLGenCtx
acSQLGenCtx :: SQLGenCtx
acSQLGenCtx :: AppContext -&gt; SQLGenCtx
</span><a href="#local-6989586621688064520"><span class="hs-identifier hs-var hs-var">acSQLGenCtx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688064522"><span class="annot"><span class="annottext">HashSet ExperimentalFeature
acExperimentalFeatures :: HashSet ExperimentalFeature
acExperimentalFeatures :: AppContext -&gt; HashSet ExperimentalFeature
</span><a href="#local-6989586621688064522"><span class="hs-identifier hs-var hs-var">acExperimentalFeatures</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688064524"><span class="annot"><span class="annottext">NamingCase
acDefaultNamingConvention :: NamingCase
acDefaultNamingConvention :: AppContext -&gt; NamingCase
</span><a href="#local-6989586621688064524"><span class="hs-identifier hs-var hs-var">acDefaultNamingConvention</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AppContext -&gt; m AppContext
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO AppContext -&gt; m AppContext) -&gt; IO AppContext -&gt; m AppContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO AppContext
forall impl. AppStateRef impl -&gt; IO AppContext
</span><a href="Hasura.Server.AppStateRef.html#getAppContext"><span class="hs-identifier hs-var">getAppContext</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621688064439"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621688064526"><span class="annot"><span class="annottext">InlinedAllowlist
</span><a href="#local-6989586621688064526"><span class="hs-identifier hs-var">allowlist</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO InlinedAllowlist -&gt; m InlinedAllowlist
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO InlinedAllowlist -&gt; m InlinedAllowlist)
-&gt; IO InlinedAllowlist -&gt; m InlinedAllowlist
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; InlinedAllowlist
</span><a href="Hasura.RQL.Types.SchemaCache.html#scAllowlist"><span class="hs-identifier hs-var">scAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; InlinedAllowlist)
-&gt; IO SchemaCache -&gt; IO InlinedAllowlist
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl -&gt; IO SchemaCache
forall impl. AppStateRef impl -&gt; IO SchemaCache
</span><a href="Hasura.Server.AppStateRef.html#getSchemaCache"><span class="hs-identifier hs-var">getSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621688064439"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621688064528"><span class="annot"><span class="annottext">CorsPolicy
</span><a href="#local-6989586621688064528"><span class="hs-identifier hs-var">corsPolicy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CorsPolicy -&gt; m CorsPolicy
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO CorsPolicy
</span><a href="#local-6989586621688064512"><span class="hs-identifier hs-var">getCorsPolicy</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621688064529"><span class="annot"><span class="annottext">WSServer WSConnData
</span><a href="#local-6989586621688064529"><span class="hs-identifier hs-var">wsServer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (WSServer WSConnData) -&gt; m (WSServer WSConnData)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (WSServer WSConnData) -&gt; m (WSServer WSConnData))
-&gt; IO (WSServer WSConnData) -&gt; m (WSServer WSConnData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM (WSServer WSConnData) -&gt; IO (WSServer WSConnData)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">STM.atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (WSServer WSConnData) -&gt; IO (WSServer WSConnData))
-&gt; STM (WSServer WSConnData) -&gt; IO (WSServer WSConnData)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AuthMode
-&gt; AllowListStatus
-&gt; InlinedAllowlist
-&gt; CorsPolicy
-&gt; SQLGenCtx
-&gt; HashSet ExperimentalFeature
-&gt; NamingCase
-&gt; Logger Hasura
-&gt; STM (WSServer WSConnData)
forall a.
AuthMode
-&gt; AllowListStatus
-&gt; InlinedAllowlist
-&gt; CorsPolicy
-&gt; SQLGenCtx
-&gt; HashSet ExperimentalFeature
-&gt; NamingCase
-&gt; Logger Hasura
-&gt; STM (WSServer a)
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#createWSServer"><span class="hs-identifier hs-var">WS.createWSServer</span></a></span><span> </span><span class="annot"><span class="annottext">AuthMode
</span><a href="#local-6989586621688064519"><span class="hs-identifier hs-var">acAuthMode</span></a></span><span> </span><span class="annot"><span class="annottext">AllowListStatus
</span><a href="#local-6989586621688064517"><span class="hs-identifier hs-var">acEnableAllowlist</span></a></span><span> </span><span class="annot"><span class="annottext">InlinedAllowlist
</span><a href="#local-6989586621688064526"><span class="hs-identifier hs-var">allowlist</span></a></span><span> </span><span class="annot"><span class="annottext">CorsPolicy
</span><a href="#local-6989586621688064528"><span class="hs-identifier hs-var">corsPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">SQLGenCtx
</span><a href="#local-6989586621688064520"><span class="hs-identifier hs-var">acSQLGenCtx</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ExperimentalFeature
</span><a href="#local-6989586621688064522"><span class="hs-identifier hs-var">acExperimentalFeatures</span></a></span><span> </span><span class="annot"><span class="annottext">NamingCase
</span><a href="#local-6989586621688064524"><span class="hs-identifier hs-var">acDefaultNamingConvention</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688064514"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">WSServerEnv impl -&gt; m (WSServerEnv impl)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">(WSServerEnv impl -&gt; m (WSServerEnv impl))
-&gt; WSServerEnv impl -&gt; m (WSServerEnv impl)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; SubscriptionsState
-&gt; AppStateRef impl
-&gt; Manager
-&gt; IO CorsPolicy
-&gt; ReadOnlyMode
-&gt; WSServer WSConnData
-&gt; KeepAliveDelay
-&gt; ServerMetrics
-&gt; PrometheusMetrics
-&gt; SamplingPolicy
-&gt; WSServerEnv impl
forall impl.
Logger Hasura
-&gt; SubscriptionsState
-&gt; AppStateRef impl
-&gt; Manager
-&gt; IO CorsPolicy
-&gt; ReadOnlyMode
-&gt; WSServer WSConnData
-&gt; KeepAliveDelay
-&gt; ServerMetrics
-&gt; PrometheusMetrics
-&gt; SamplingPolicy
-&gt; WSServerEnv impl
</span><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#WSServerEnv"><span class="hs-identifier hs-var">WSServerEnv</span></a></span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loggers -&gt; Logger Hasura
</span><a href="Hasura.App.State.html#_lsLogger"><span class="hs-identifier hs-var">_lsLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Loggers
</span><a href="#local-6989586621688064446"><span class="hs-identifier hs-var">appEnvLoggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">SubscriptionsState
</span><a href="#local-6989586621688064458"><span class="hs-identifier hs-var">appEnvSubscriptionState</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><span class="annottext">AppStateRef impl
</span><a href="#local-6989586621688064439"><span class="hs-identifier hs-var">appStateRef</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621688064445"><span class="hs-identifier hs-var">appEnvManager</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">IO CorsPolicy
</span><a href="#local-6989586621688064512"><span class="hs-identifier hs-var">getCorsPolicy</span></a></span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="#local-6989586621688064452"><span class="hs-identifier hs-var">appEnvEnableReadOnlyMode</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="annottext">WSServer WSConnData
</span><a href="#local-6989586621688064529"><span class="hs-identifier hs-var">wsServer</span></a></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">KeepAliveDelay
</span><a href="#local-6989586621688064465"><span class="hs-identifier hs-var">appEnvWebSocketKeepAlive</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">ServerMetrics
</span><a href="#local-6989586621688064453"><span class="hs-identifier hs-var">appEnvServerMetrics</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">PrometheusMetrics
</span><a href="#local-6989586621688064456"><span class="hs-identifier hs-var">appEnvPrometheusMetrics</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span class="annot"><span class="annottext">SamplingPolicy
</span><a href="#local-6989586621688064457"><span class="hs-identifier hs-var">appEnvTraceSamplingPolicy</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Hasura.GraphQL.Transport.WSServerApp.html#mkWSActions"><span class="hs-identifier hs-type">mkWSActions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">L.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">L.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#WSSubProtocol"><span class="hs-identifier hs-type">WSSubProtocol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#WSActions"><span class="hs-identifier hs-type">WS.WSActions</span></a></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Transport.WebSocket.Types.html#WSConnData"><span class="hs-identifier hs-type">WSConnData</span></a></span><span>
</span><span id="line-145"></span><span id="mkWSActions"><span class="annot"><span class="annottext">mkWSActions :: Logger Hasura -&gt; WSSubProtocol -&gt; WSActions WSConnData
</span><a href="Hasura.GraphQL.Transport.WSServerApp.html#mkWSActions"><span class="hs-identifier hs-var hs-var">mkWSActions</span></a></span></span><span> </span><span id="local-6989586621688064533"><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688064533"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621688064534"><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">WSPostExecErrMessageAction WSConnData
-&gt; WSOnErrorMessageAction WSConnData
-&gt; WSCloseConnAction WSConnData
-&gt; WSKeepAliveMessageAction WSConnData
-&gt; (DataMsg -&gt; ServerMsg)
-&gt; AcceptRequest
-&gt; ([Encoding] -&gt; Encoding)
-&gt; WSActions WSConnData
forall a.
WSPostExecErrMessageAction a
-&gt; WSOnErrorMessageAction a
-&gt; WSCloseConnAction a
-&gt; WSKeepAliveMessageAction a
-&gt; (DataMsg -&gt; ServerMsg)
-&gt; AcceptRequest
-&gt; ([Encoding] -&gt; Encoding)
-&gt; WSActions a
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#WSActions"><span class="hs-identifier hs-var">WS.WSActions</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="annottext">WSPostExecErrMessageAction WSConnData
</span><a href="#local-6989586621688064536"><span class="hs-identifier hs-var">mkPostExecErrMessageAction</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">WSOnErrorMessageAction WSConnData
</span><a href="#local-6989586621688064537"><span class="hs-identifier hs-var">mkOnErrorMessageAction</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">WSCloseConnAction WSConnData
</span><a href="#local-6989586621688064538"><span class="hs-identifier hs-var">mkConnectionCloseAction</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">WSKeepAliveMessageAction WSConnData
</span><a href="#local-6989586621688064539"><span class="hs-identifier hs-var">keepAliveAction</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">DataMsg -&gt; ServerMsg
</span><a href="#local-6989586621688064540"><span class="hs-identifier hs-var">getServerMsgType</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">AcceptRequest
</span><a href="#local-6989586621688064541"><span class="hs-identifier hs-var">mkAcceptRequest</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">[Encoding] -&gt; Encoding
</span><a href="#local-6989586621688064542"><span class="hs-identifier hs-var">fmtErrorMessage</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621688064536"><span class="annot"><span class="annottext">mkPostExecErrMessageAction :: WSPostExecErrMessageAction WSConnData
</span><a href="#local-6989586621688064536"><span class="hs-identifier hs-var hs-var">mkPostExecErrMessageAction</span></a></span></span><span> </span><span id="local-6989586621688064543"><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064543"><span class="hs-identifier hs-var">wsConn</span></a></span></span><span> </span><span id="local-6989586621688064544"><span class="annot"><span class="annottext">OperationId
</span><a href="#local-6989586621688064544"><span class="hs-identifier hs-var">opId</span></a></span></span><span> </span><span id="local-6989586621688064545"><span class="annot"><span class="annottext">GQExecError
</span><a href="#local-6989586621688064545"><span class="hs-identifier hs-var">execErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">WSConn WSConnData -&gt; ServerMsg -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
WSConn WSConnData -&gt; ServerMsg -&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#sendMsg"><span class="hs-identifier hs-var">sendMsg</span></a></span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064543"><span class="hs-identifier hs-var">wsConn</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerMsg -&gt; IO ()) -&gt; ServerMsg -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#Apollo"><span class="hs-identifier hs-var">Apollo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataMsg -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMData"><span class="hs-identifier hs-var">SMData</span></a></span><span> </span><span class="annot"><span class="annottext">(DataMsg -&gt; ServerMsg) -&gt; DataMsg -&gt; ServerMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OperationId -&gt; GQResponse -&gt; DataMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#DataMsg"><span class="hs-identifier hs-var">DataMsg</span></a></span><span> </span><span class="annot"><span class="annottext">OperationId
</span><a href="#local-6989586621688064544"><span class="hs-identifier hs-var">opId</span></a></span><span> </span><span class="annot"><span class="annottext">(GQResponse -&gt; DataMsg) -&gt; GQResponse -&gt; DataMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GQExecError -&gt; GQResponse
forall a. GQExecError -&gt; Either GQExecError a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">GQExecError
</span><a href="#local-6989586621688064545"><span class="hs-identifier hs-var">execErr</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#GraphQLWS"><span class="hs-identifier hs-var">GraphQLWS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMErr"><span class="hs-identifier hs-var">SMErr</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; ServerMsg) -&gt; ErrorMsg -&gt; ServerMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OperationId -&gt; Encoding -&gt; ErrorMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#ErrorMsg"><span class="hs-identifier hs-var">ErrorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">OperationId
</span><a href="#local-6989586621688064544"><span class="hs-identifier hs-var">opId</span></a></span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; ErrorMsg) -&gt; Encoding -&gt; ErrorMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GQExecError -&gt; Encoding
</span><a href="Hasura.GraphQL.Transport.HTTP.Protocol.html#encodeGQExecError"><span class="hs-identifier hs-var">encodeGQExecError</span></a></span><span> </span><span class="annot"><span class="annottext">GQExecError
</span><a href="#local-6989586621688064545"><span class="hs-identifier hs-var">execErr</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621688064537"><span class="annot"><span class="annottext">mkOnErrorMessageAction :: WSOnErrorMessageAction WSConnData
</span><a href="#local-6989586621688064537"><span class="hs-identifier hs-var hs-var">mkOnErrorMessageAction</span></a></span></span><span> </span><span id="local-6989586621688064554"><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064554"><span class="hs-identifier hs-var">wsConn</span></a></span></span><span> </span><span id="local-6989586621688064555"><span class="annot"><span class="annottext">ConnErrMsg
</span><a href="#local-6989586621688064555"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621688064556"><span class="annot"><span class="annottext">WSErrorMessage
</span><a href="#local-6989586621688064556"><span class="hs-identifier hs-var">mErrMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#Apollo"><span class="hs-identifier hs-var">Apollo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-163"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WSErrorMessage
</span><a href="#local-6989586621688064556"><span class="hs-identifier hs-var">mErrMsg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>            </span><span class="annot"><span class="annottext">WSErrorMessage
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#ConnInitFailed"><span class="hs-identifier hs-var">WS.ConnInitFailed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; WSConn WSConnData
-&gt; ServerErrorCode
-&gt; Maybe ServerMsg
-&gt; Maybe Word16
-&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura
-&gt; WSConn WSConnData
-&gt; ServerErrorCode
-&gt; Maybe ServerMsg
-&gt; Maybe Word16
-&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#sendCloseWithMsg"><span class="hs-identifier hs-var">sendCloseWithMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688064533"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064554"><span class="hs-identifier hs-var">wsConn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSSubProtocol -&gt; WSErrorMessage -&gt; ConnErrMsg -&gt; ServerErrorCode
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#mkWSServerErrorCode"><span class="hs-identifier hs-var">WS.mkWSServerErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">WSErrorMessage
</span><a href="#local-6989586621688064556"><span class="hs-identifier hs-var">mErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">ConnErrMsg
</span><a href="#local-6989586621688064555"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerMsg -&gt; Maybe ServerMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ServerMsg -&gt; Maybe ServerMsg) -&gt; ServerMsg -&gt; Maybe ServerMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnErrMsg -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMConnErr"><span class="hs-identifier hs-var">SMConnErr</span></a></span><span> </span><span class="annot"><span class="annottext">ConnErrMsg
</span><a href="#local-6989586621688064555"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Word16
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-165"></span><span>            </span><span class="annot"><span class="annottext">WSErrorMessage
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#ClientMessageParseFailed"><span class="hs-identifier hs-var">WS.ClientMessageParseFailed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData -&gt; ServerMsg -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
WSConn WSConnData -&gt; ServerMsg -&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#sendMsg"><span class="hs-identifier hs-var">sendMsg</span></a></span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064554"><span class="hs-identifier hs-var">wsConn</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerMsg -&gt; IO ()) -&gt; ServerMsg -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnErrMsg -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMConnErr"><span class="hs-identifier hs-var">SMConnErr</span></a></span><span> </span><span class="annot"><span class="annottext">ConnErrMsg
</span><a href="#local-6989586621688064555"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#GraphQLWS"><span class="hs-identifier hs-var">GraphQLWS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; WSConn WSConnData
-&gt; ServerErrorCode
-&gt; Maybe ServerMsg
-&gt; Maybe Word16
-&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura
-&gt; WSConn WSConnData
-&gt; ServerErrorCode
-&gt; Maybe ServerMsg
-&gt; Maybe Word16
-&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#sendCloseWithMsg"><span class="hs-identifier hs-var">sendCloseWithMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688064533"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064554"><span class="hs-identifier hs-var">wsConn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSSubProtocol -&gt; WSErrorMessage -&gt; ConnErrMsg -&gt; ServerErrorCode
</span><a href="Hasura.GraphQL.Transport.WebSocket.Server.html#mkWSServerErrorCode"><span class="hs-identifier hs-var">WS.mkWSServerErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">WSErrorMessage
</span><a href="#local-6989586621688064556"><span class="hs-identifier hs-var">mErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">ConnErrMsg
</span><a href="#local-6989586621688064555"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ServerMsg
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Word16
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621688064538"><span class="annot"><span class="annottext">mkConnectionCloseAction :: WSCloseConnAction WSConnData
</span><a href="#local-6989586621688064538"><span class="hs-identifier hs-var hs-var">mkConnectionCloseAction</span></a></span></span><span> </span><span id="local-6989586621688064562"><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064562"><span class="hs-identifier hs-var">wsConn</span></a></span></span><span> </span><span id="local-6989586621688064563"><span class="annot"><span class="annottext">OperationId
</span><a href="#local-6989586621688064563"><span class="hs-identifier hs-var">opId</span></a></span></span><span> </span><span id="local-6989586621688064564"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688064564"><span class="hs-identifier hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol -&gt; WSSubProtocol -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#GraphQLWS"><span class="hs-identifier hs-var">GraphQLWS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; WSConn WSConnData
-&gt; ServerErrorCode
-&gt; Maybe ServerMsg
-&gt; Maybe Word16
-&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger Hasura
-&gt; WSConn WSConnData
-&gt; ServerErrorCode
-&gt; Maybe ServerMsg
-&gt; Maybe Word16
-&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#sendCloseWithMsg"><span class="hs-identifier hs-var">sendCloseWithMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688064533"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064562"><span class="hs-identifier hs-var">wsConn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ServerErrorCode
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#GenericError4400"><span class="hs-identifier hs-var">GenericError4400</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688064564"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerMsg -&gt; Maybe ServerMsg
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ServerMsg -&gt; Maybe ServerMsg)
-&gt; (ErrorMsg -&gt; ServerMsg) -&gt; ErrorMsg -&gt; Maybe ServerMsg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMErr"><span class="hs-identifier hs-var">SMErr</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg -&gt; Maybe ServerMsg) -&gt; ErrorMsg -&gt; Maybe ServerMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OperationId -&gt; Encoding -&gt; ErrorMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#ErrorMsg"><span class="hs-identifier hs-var">ErrorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">OperationId
</span><a href="#local-6989586621688064563"><span class="hs-identifier hs-var">opId</span></a></span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; ErrorMsg) -&gt; Encoding -&gt; ErrorMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Encoding
forall a. ToJSON a =&gt; a -&gt; Encoding
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toEncoding"><span class="hs-identifier hs-var">J.toEncoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/text-2.0.1-d0f6d61f5277bae932134563876cbceb4967915f364959864c72abbc2978d8ed/share/doc/html/src/Data.Text.html#pack"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688064564"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Maybe Word16
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621688064540"><span class="annot"><span class="annottext">getServerMsgType :: DataMsg -&gt; ServerMsg
</span><a href="#local-6989586621688064540"><span class="hs-identifier hs-var hs-var">getServerMsgType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#Apollo"><span class="hs-identifier hs-var">Apollo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataMsg -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMData"><span class="hs-identifier hs-var">SMData</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#GraphQLWS"><span class="hs-identifier hs-var">GraphQLWS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataMsg -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMNext"><span class="hs-identifier hs-var">SMNext</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621688064539"><span class="annot"><span class="annottext">keepAliveAction :: WSKeepAliveMessageAction WSConnData
</span><a href="#local-6989586621688064539"><span class="hs-identifier hs-var hs-var">keepAliveAction</span></a></span></span><span> </span><span id="local-6989586621688064570"><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064570"><span class="hs-identifier hs-var">wsConn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData -&gt; ServerMsg -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
WSConn WSConnData -&gt; ServerMsg -&gt; m ()
</span><a href="Hasura.GraphQL.Transport.WebSocket.html#sendMsg"><span class="hs-identifier hs-var">sendMsg</span></a></span><span> </span><span class="annot"><span class="annottext">WSConn WSConnData
</span><a href="#local-6989586621688064570"><span class="hs-identifier hs-var">wsConn</span></a></span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="annottext">(ServerMsg -&gt; IO ()) -&gt; ServerMsg -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#Apollo"><span class="hs-identifier hs-var">Apollo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMConnKeepAlive"><span class="hs-identifier hs-var">SMConnKeepAlive</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#GraphQLWS"><span class="hs-identifier hs-var">GraphQLWS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe PingPongPayload -&gt; ServerMsg
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#SMPing"><span class="hs-identifier hs-var">SMPing</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe PingPongPayload -&gt; ServerMsg)
-&gt; (PingPongPayload -&gt; Maybe PingPongPayload)
-&gt; PingPongPayload
-&gt; ServerMsg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PingPongPayload -&gt; Maybe PingPongPayload
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PingPongPayload -&gt; ServerMsg) -&gt; PingPongPayload -&gt; ServerMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PingPongPayload
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#keepAliveMessage"><span class="hs-identifier hs-var">keepAliveMessage</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621688064541"><span class="annot"><span class="annottext">mkAcceptRequest :: AcceptRequest
</span><a href="#local-6989586621688064541"><span class="hs-identifier hs-var hs-var">mkAcceptRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">AcceptRequest
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/websockets-0.12.7.3-ace9e650e85dd6f2f2179ec47bba2f5dfacb8e002a1c77fe7c2fbe7ac37aed32/share/doc/html/src/Network.WebSockets.Connection.html#defaultAcceptRequest"><span class="hs-identifier hs-var">WS.defaultAcceptRequest</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">acceptSubprotocol :: Maybe ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/websockets-0.12.7.3-ace9e650e85dd6f2f2179ec47bba2f5dfacb8e002a1c77fe7c2fbe7ac37aed32/share/doc/html/src/Network.WebSockets.Connection.html#acceptSubprotocol"><span class="hs-identifier hs-var">WS.acceptSubprotocol</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString)
-&gt; (WSSubProtocol -&gt; ByteString)
-&gt; WSSubProtocol
-&gt; Maybe ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">B.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ByteString)
-&gt; (WSSubProtocol -&gt; String) -&gt; WSSubProtocol -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol -&gt; String
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#showSubProtocol"><span class="hs-identifier hs-var">showSubProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">(WSSubProtocol -&gt; Maybe ByteString)
-&gt; WSSubProtocol -&gt; Maybe ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621688064542"><span class="annot"><span class="annottext">fmtErrorMessage :: [Encoding] -&gt; Encoding
</span><a href="#local-6989586621688064542"><span class="hs-identifier hs-var hs-var">fmtErrorMessage</span></a></span></span><span> </span><span id="local-6989586621688064577"><span class="annot"><span class="annottext">[Encoding]
</span><a href="#local-6989586621688064577"><span class="hs-identifier hs-var">errMsgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="#local-6989586621688064534"><span class="hs-identifier hs-var">subProtocol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#Apollo"><span class="hs-identifier hs-var">Apollo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Series -&gt; Encoding
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Encoding.Internal.html#pairs"><span class="hs-identifier hs-var">J.pairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key -&gt; Encoding -&gt; Series
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Encoding.Internal.html#pair"><span class="hs-identifier hs-var">J.pair</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;errors&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; Series) -&gt; Encoding -&gt; Series
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; Encoding) -&gt; [Encoding] -&gt; Encoding
forall a. (a -&gt; Encoding) -&gt; [a] -&gt; Encoding
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Encoding.Internal.html#list"><span class="hs-identifier hs-var">J.list</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[Encoding]
</span><a href="#local-6989586621688064577"><span class="hs-identifier hs-var">errMsgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><span class="annottext">WSSubProtocol
</span><a href="Hasura.GraphQL.Transport.WebSocket.Protocol.html#GraphQLWS"><span class="hs-identifier hs-var">GraphQLWS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Encoding -&gt; Encoding) -&gt; [Encoding] -&gt; Encoding
forall a. (a -&gt; Encoding) -&gt; [a] -&gt; Encoding
</span><a href="file:///root/.local/state/cabal/store/ghc-9.4.5/aeson-2.1.2.1-e70cfd91223b3d0131c9afbae5e81df0c65350557c5511cf0c25a451c1483207/share/doc/html/src/Data.Aeson.Encoding.Internal.html#list"><span class="hs-identifier hs-var">J.list</span></a></span><span> </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[Encoding]
</span><a href="#local-6989586621688064577"><span class="hs-identifier hs-var">errMsgs</span></a></span><span>
</span><span id="line-189"></span></pre></body></html>